<script>
  async function connectWallet(roomId) {
    const selector = document.querySelector(`.number-selector-${roomId}`);
    const selectedNumber = selector.value;

    if (!selectedNumber) {
      alert("‚ö†Ô∏è Por favor selecciona un n√∫mero antes de unirte.");
      return;
    }

    if (typeof window.ethereum !== 'undefined') {
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const wallet = accounts[0];

        // Valor estimado en BNB para $0.50 (ajustable)
        const bnbAmount = 0.0022; // Aproximadamente 0.50 USD
        const hexValue = '0x' + (bnbAmount * 1e18).toString(16);

        const tx = {
          from: wallet,
          to: '0x659a0f0D27378c9f25B97B0fE0F0df6fD1a6D3d4',
          value: hexValue
        };

        await window.ethereum.request({
          method: 'eth_sendTransaction',
          params: [tx]
        });

        alert(`‚úÖ Te uniste a la Sala #${roomId} con el n√∫mero ${selectedNumber} üéâ`);

        const roomEl = document.querySelector(`.room[data-id='${roomId}'] .participant-count`);
        let newCount = parseInt(roomEl.textContent) + 1;
        roomEl.textContent = newCount;

        if (newCount >= 200) {
          setTimeout(() => {
            spinWheel(roomId);
          }, 2000);
        }

      } catch (error) {
        alert("‚ùå Error al procesar la transacci√≥n: " + error.message);
      }
    } else {
      alert("‚ö†Ô∏è MetaMask no est√° disponible. Inst√°lalo para continuar.");
    }
  }
</script>
