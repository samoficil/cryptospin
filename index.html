<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ruleta estilo Wheel of Names </title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1e1e1e;
    color: white;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  header {
    padding: 15px 10px;
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    text-align: center;
    width: 100%;
    background: #282828;
    user-select: none;
  }
  #container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    gap: 20px;
    max-width: 1000px;
    flex-grow: 1;
    box-sizing: border-box;
  }
  #editor {
    flex: 1 1 300px;
    min-width: 280px;
    display: flex;
    flex-direction: column;
  }
  #namesInput {
    flex-grow: 1;
    resize: none;
    font-size: 1.1rem;
    padding: 10px;
    border-radius: 8px;
    border: none;
    background: #2e2e2e;
    color: white;
    font-family: monospace;
    box-sizing: border-box;
  }
  #btnClear {
    margin-top: 10px;
    background: #f44336;
    border: none;
    color: white;
    font-weight: 700;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
  }
  #btnClear:hover {
    background: #d32f2f;
  }
  #wheelContainer {
    flex: 1 1 500px;
    min-width: 320px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #canvas {
    border-radius: 50%;
    background: #222;
    box-shadow: 0 0 15px #0008 inset;
  }
  #spinButton {
    margin-top: 20px;
    font-size: 1.5rem;
    padding: 15px 40px;
    background: #4caf50;
    border: none;
    color: white;
    font-weight: 700;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s;
  }
  #spinButton:disabled {
    background: #777;
    cursor: not-allowed;
  }
  #spinButton:hover:not(:disabled) {
    background: #43a047;
  }
  /* Pointer */
  #pointer {
    width: 0; 
    height: 0; 
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 30px solid #4caf50;
    margin-top: 15px;
    filter: drop-shadow(0 0 4px #4caf50);
  }
</style>
</head>
<body>

<header>Ruleta estilo Wheel of Names</header>

<div id="container">

  <div id="editor">
    <label for="namesInput" style="margin-bottom: 8px; font-weight:600;">Lista de Nombres (uno por l铆nea):</label>
    <textarea id="namesInput" placeholder="Escribe aqu铆 los nombres..."></textarea>
    <button id="btnClear">Borrar Lista</button>
  </div>

  <div id="wheelContainer">
    <canvas id="canvas" width="450" height="450"></canvas>
    <div id="pointer"></div>
    <button id="spinButton">Girar </button>
  </div>

</div>

<script>
(() => {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const spinBtn = document.getElementById('spinButton');
  const namesInput = document.getElementById('namesInput');
  const btnClear = document.getElementById('btnClear');
  const center = canvas.width / 2;
  const radius = center - 20;

  let names = [];
  let colors = [];
  let startAngle = 0;
  let arc = 0;
  let spinning = false;
  let spinAngleStart = 0;
  let spinTime = 0;
  let spinTimeTotal = 0;

  // Colores base para segmentos
  const baseColors = [
    "#e74c3c", "#8e44ad", "#3498db", "#16a085", 
    "#f39c12", "#d35400", "#2ecc71", "#34495e"
  ];

  // Funci贸n para guardar lista en localStorage
  function saveNames() {
    localStorage.setItem('wheelNames', namesInput.value.trim());
  }

  // Funci贸n para cargar lista de localStorage
  function loadNames() {
    const saved = localStorage.getItem('wheelNames');
    if (saved) {
      namesInput.value = saved;
      updateNames();
    }
  }

  // Actualizar lista de nombres y colores
  function updateNames() {
    const rawNames = namesInput.value.split('\n').map(n => n.trim()).filter(n => n);
    names = rawNames.length ? rawNames : ['Sin Nombres'];
    arc = 2 * Math.PI / names.length;
    generateColors();
    saveNames();
    drawWheel();
  }

  // Generar colores para segmentos (repitiendo si hace falta)
  function generateColors() {
    colors = [];
    for (let i = 0; i < names.length; i++) {
      colors.push(baseColors[i % baseColors.length]);
    }
  }

  // Dibujar la ruleta
  function drawWheel() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.lineWidth = 2;
    ctx.strokeStyle = '#222';

    for (let i = 0; i < names.length; i++) {
      const angle = startAngle + i * arc;
      // segmento
      ctx.beginPath();
      ctx.fillStyle = colors[i];
      ctx.moveTo(center, center);
      ctx.arc(center, center, radius, angle, angle + arc);
      ctx.lineTo(center, center);
      ctx.fill();
      ctx.stroke();

      // texto
      ctx.save();
      ctx.fillStyle = '#fff';
      ctx.translate(center, center);
      ctx.rotate(angle + arc / 2);
      ctx.textAlign = "right";
      ctx.font = "bold 16px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
      ctx.fillText(names[i], radius - 10, 10);
      ctx.restore();
    }
  }

  // Easing para desacelerar giro
  function easeOut(t, b, c, d) {
    const ts = (t /= d) * t;
    const tc = ts * t;
    return b + c * (tc + -3 * ts + 3 * t);
  }

  // Animar giro
  function rotateWheel() {
    spinTime += 30;
    if (spinTime >= spinTimeTotal) {
      stopRotateWheel();
      return;
    }
    const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
    startAngle += spinAngle * Math.PI / 180;
    drawWheel();
    setTimeout(rotateWheel, 30);
  }

  // Al terminar el giro, mostrar ganador
  function stopRotateWheel() {
    spinning = false;
    spinBtn.disabled = false;
    // Calcular segmento ganador
    const degrees = startAngle * 180 / Math.PI + 90;
    const arcd = arc * 180 / Math.PI;
    const index = Math.floor((360 - (degrees % 360)) / arcd);
    alert(` 隆Gan贸: ${names[index]}! `);
  }

  // Funci贸n para iniciar giro
  function startSpin() {
    if (spinning) return;
    spinning = true;
    spinBtn.disabled = true;
    spinAngleStart = Math.floor(Math.random() * 360) + 360 * 5;
    spinTime = 0;
    spinTimeTotal = Math.floor(Math.random() * 3000) + 4000;
    rotateWheel();
  }

  // Evento textarea cambio
  namesInput.addEventListener('input', updateNames);

  // Evento limpiar lista
  btnClear.addEventListener('click', () => {
    namesInput.value = '';
    updateNames();
  });

  // Evento bot贸n girar
  spinBtn.addEventListener('click', startSpin);

  // Cargar lista guardada al inicio
  loadNames();

  // Dibuja la ruleta al inicio aunque lista est茅 vac铆a
  drawWheel();

})();
</script>

</body>
</html>
