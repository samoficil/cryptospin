<!-- Sala individual con rueda integrada y animaci√≥n de giro con suspenso -->
<div class="bg-gray-700 rounded-xl p-4 shadow-xl room" data-id="1" data-participants="50" style="max-width: 820px; margin: auto;">
  <h3 class="text-lg font-bold mb-2">Sala #1</h3>
  <p>Participantes: <span class="participant-count">50</span> / 200</p>
  <button id="joinBtn1" class="mt-2 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full">Unirse por $0.50</button>
  
  <div class="mt-4 relative" style="width: 800px; height: 800px;">
    <canvas id="wheelCanvas1" width="800" height="800"></canvas>
  </div>
</div>

<script>
  // Datos de la rueda (por ejemplo, n√∫meros 1 a 10)
  const segments = ["1","2","3","4","5","6","7","8","9","10"];
  const wheelCanvas = document.getElementById("wheelCanvas1");
  const ctx = wheelCanvas.getContext("2d");
  const centerX = wheelCanvas.width / 2;
  const centerY = wheelCanvas.height / 2;
  const radius = 350;
  const segmentAngle = (2 * Math.PI) / segments.length;

  let startAngle = 0;
  let spinning = false;
  let spinStartTime;
  let spinDuration = 20000; // 20 segundos

  // Ganador elegido aleatoriamente (puede venir din√°mico)
  const winnerIndex = Math.floor(Math.random() * segments.length);

  // Funci√≥n para dibujar la rueda
  function drawWheel(angle) {
    ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
    ctx.lineWidth = 5;
    ctx.strokeStyle = "#fff";
    ctx.font = "bold 24px Arial";
    ctx.textAlign = "right";
    ctx.textBaseline = "middle";

    for(let i = 0; i < segments.length; i++) {
      const start = angle + i * segmentAngle;
      const end = start + segmentAngle;
      ctx.beginPath();
      ctx.fillStyle = i % 2 === 0 ? "#16a34a" : "#22c55e"; // alterna verde oscuro y claro
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, start, end);
      ctx.lineTo(centerX, centerY);
      ctx.fill();
      ctx.stroke();

      // Texto en segmento
      ctx.save();
      ctx.fillStyle = "#fff";
      ctx.translate(centerX + Math.cos(start + segmentAngle / 2) * (radius - 40), centerY + Math.sin(start + segmentAngle / 2) * (radius - 40));
      ctx.rotate(start + segmentAngle / 2 + Math.PI / 2);
      ctx.fillText(segments[i], 0, 0);
      ctx.restore();
    }

    // Dibuja indicador
    ctx.fillStyle = "#ff0000";
    ctx.beginPath();
    ctx.moveTo(centerX, centerY - radius - 20);
    ctx.lineTo(centerX - 20, centerY - radius + 20);
    ctx.lineTo(centerX + 20, centerY - radius + 20);
    ctx.closePath();
    ctx.fill();
  }

  // Funci√≥n de easing para desacelerar al final (easeOutQuad)
  function easeOutQuad(t) {
    return t * (2 - t);
  }

  function animateSpin(timestamp) {
    if (!spinStartTime) spinStartTime = timestamp;
    const elapsed = timestamp - spinStartTime;

    if (elapsed < spinDuration) {
      // Progreso de 0 a 1
      let progress = elapsed / spinDuration;

      // Acelerar al inicio y desacelerar al final para suspenso
      // Usamos easing para desacelerar m√°s cerca del final
      let easedProgress = easeOutQuad(progress);

      // Calcular √°ngulo total girado
      // Queremos que termine en el segmento ganador con el puntero arriba
      const fullSpins = 5; // cantidad de vueltas completas
      const finalAngle = (2 * Math.PI) * fullSpins + (2 * Math.PI) - (winnerIndex * segmentAngle + segmentAngle / 2);

      startAngle = easedProgress * finalAngle;

      drawWheel(startAngle);

      requestAnimationFrame(animateSpin);
    } else {
      // Fin del giro: detener en el ganador con suspenso
      startAngle = (2 * Math.PI) * 5 + (2 * Math.PI) - (winnerIndex * segmentAngle + segmentAngle / 2);
      drawWheel(startAngle);
      alert(`¬°La rueda se detuvo en el n√∫mero ganador: ${segments[winnerIndex]}! üéâ`);
      spinning = false;
      document.getElementById("joinBtn1").disabled = false;
      document.getElementById("joinBtn1").textContent = "Unirse por $0.50";
    }
  }

  document.getElementById("joinBtn1").addEventListener("click", () => {
    if (spinning) return;
    spinning = true;
    document.getElementById("joinBtn1").disabled = true;
    document.getElementById("joinBtn1").textContent = "Girando...";
    spinStartTime = null;
    requestAnimationFrame(animateSpin);
  });

  drawWheel(0);
</script>
