<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üî±GLOBAL CASH TIMEüî±</title>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    body { background-color: #0b0f19; color: white; font-family: sans-serif; }
    iframe { pointer-events: none; border-radius: 12px; border: 2px solid #4ade80; margin-top: 20px; }
    .hidden-section { display: none; }
    .num-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; max-height: 180px; overflow-y: auto; padding: 10px; background: #111827; border-radius: 8px; border: 1px solid #374151; }
    .num-btn { background: #1f2937; color: #4ade80; font-size: 10px; padding: 6px 0; border-radius: 4px; text-align: center; cursor: pointer; border: 1px solid #374151; }
    .num-btn.selected { background: #4ade80 !important; color: black !important; font-weight: bold; }
    .num-btn.occupied { background: #ef4444 !important; color: white !important; cursor: not-allowed; opacity: 0.6; }
    .room-card { background-color: #111827; border: 1px solid #374151; border-radius: 1rem; padding: 1.25rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
  </style>
</head>
<body>

  <header class="p-4 bg-gray-900 flex justify-between items-center border-b border-green-500 sticky top-0 z-50">
    <div class="w-1/4"></div> 
    <div class="w-1/2 text-center text-2xl md:text-3xl font-extrabold tracking-widest text-white">üî±GLOBAL CASH TIMEüî±</div>
    <nav class="w-1/4 flex justify-end gap-4 text-xs font-bold uppercase">
      <button onclick="showSection('inicio')" class="hover:text-green-400">Inicio</button>
      <button onclick="showSection('perfil')" class="hover:text-green-400">Perfil</button>
      <button id="loginBtn" onclick="toggleAuth()" class="bg-blue-600 px-3 py-1 rounded">LOGIN</button>
    </nav>
  </header>

  <main class="p-6">
    <section id="inicio-section">
      <div class="text-center mb-8">
        <h2 class="text-xl font-semibold text-green-400 uppercase tracking-tighter">Saldo: $<span id="mainBalance">0.00</span></h2>
        <button onclick="directRecharge()" class="mt-2 text-[10px] bg-gray-800 border border-green-500 px-4 py-1 rounded-full text-green-400 font-bold uppercase">+ RECARGAR USDT</button>
      </div>
      <div id="rooms" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <section id="perfil-section" class="hidden-section max-w-2xl mx-auto room-card text-center">
      <h2 class="text-2xl font-bold mb-4 text-green-400 uppercase">Dashboard</h2>
      <p id="userEmail" class="text-xs text-gray-500 mb-6"></p>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8 border-b border-gray-700 pb-8">
        <div><p class="text-gray-500 text-xs uppercase font-bold">Saldo</p><p class="text-4xl font-extrabold">$<span id="dashBalance">0.00</span></p></div>
        <div class="flex flex-col gap-3">
          <button onclick="directRecharge()" class="bg-green-600 py-2 rounded font-bold text-xs uppercase">Recargar</button>
          <button onclick="alert('Retiro manual. Contacta al admin.')" class="bg-red-600 py-2 rounded font-bold text-xs uppercase">Retirar</button>
        </div>
      </div>
      <h3 class="font-bold text-sm mb-4 uppercase text-gray-400">Historial Individual</h3>
      <div id="history" class="text-xs space-y-2 max-h-48 overflow-y-auto"></div>
    </section>
  </main>

  <footer class="p-8 text-center text-gray-600 text-sm border-t border-gray-800">
    ¬© 2026 Global Cash Time - Todos los derechos reservados.
  </footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD3DzTIcGfQJ3WuQY1JeqkBf69XCumQtjA",
      authDomain: "globalcash-6fbe8.firebaseapp.com",
      projectId: "globalcash-6fbe8",
      storageBucket: "globalcash-6fbe8.firebasestorage.app",
      messagingSenderId: "476476155798",
      appId: "1:476476155798:web:d2827158eaba1f768d5fb7"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const MY_WALLET = "TFtX2tLdjqTnTdVAUfQ8YNACv6QUAK9LAy";
    let currentUser = null;

    async function toggleAuth() {
      if (currentUser) { await auth.signOut(); location.reload(); } 
      else { const provider = new firebase.auth.GoogleAuthProvider(); await auth.signInWithPopup(provider); }
    }

    auth.onAuthStateChanged(user => {
      if (user) { currentUser = user; document.getElementById("loginBtn").textContent = "LOGOUT"; syncUser(); loadOccupied(); }
      else { currentUser = null; document.getElementById("loginBtn").textContent = "LOGIN"; }
    });

    async function syncUser() {
      const userRef = db.collection("usuarios").doc(currentUser.uid);
      const doc = await userRef.get();
      if (!doc.exists) await userRef.set({ balance: 0, history: [] });
      const data = (await userRef.get()).data();
      document.getElementById("mainBalance").textContent = data.balance.toFixed(2);
      document.getElementById("dashBalance").textContent = data.balance.toFixed(2);
      document.getElementById("history").innerHTML = (data.history || []).map(x => `<div class="bg-gray-800 p-2 border border-gray-700 rounded text-center">Sala #${x.room}: ${x.nums}</div>`).reverse().join('');
    }

    async function buyTickets(room) {
      if (!currentUser) return alert("Login primero");
      const roomDiv = document.querySelectorAll('#rooms > div')[room-1];
      const selectedNums = Array.from(roomDiv.querySelectorAll('.num-btn.selected')).map(b => b.textContent);
      if (selectedNums.length === 0) return alert("Selecciona n√∫meros");
      const cost = selectedNums.length * 0.50;
      const userRef = db.collection("usuarios").doc(currentUser.uid);
      const userDoc = await userRef.get();
      if (userDoc.data().balance < cost) return directRecharge();
      await userRef.update({ balance: userDoc.data().balance - cost, history: firebase.firestore.FieldValue.arrayUnion({ room, nums: selectedNums.join(", "), date: new Date().toLocaleDateString() }) });
      await db.collection("salas").doc(`sala_${room}`).set({ numeros: firebase.firestore.FieldValue.arrayUnion(...selectedNums) }, { merge: true });
      syncUser(); loadOccupied();
    }

    async function loadOccupied() {
      for(let i=1; i<=10; i++) {
        const doc = await db.collection("salas").doc(`sala_${i}`).get();
        if(doc.exists) {
          const occupied = doc.data().numeros || [];
          document.querySelectorAll(`#rooms > div:nth-child(${i}) .num-btn`).forEach(btn => {
            if(occupied.includes(btn.textContent)) { btn.classList.add('occupied'); btn.onclick = null; }
          });
        }
      }
    }

    async function reclaimPrize(room, giro, premio) {
      if (!currentUser) return;
      const winnerNum = prompt(`Giro ${giro}: ¬øN√∫mero ganador?`);
      if (!winnerNum) return;
      const userDoc = await db.collection("usuarios").doc(currentUser.uid).get();
      const hasWon = (userDoc.data().history || []).some(h => h.room === room && h.nums.split(", ").includes(winnerNum));
      if (hasWon) {
        await db.collection("usuarios").doc(currentUser.uid).update({ balance: userDoc.data().balance + premio });
        alert(`¬°Ganaste $${premio}!`); syncUser();
      } else { alert("N√∫mero no encontrado."); }
    }

    function showSection(name) {
      document.getElementById('inicio-section').classList.toggle('hidden-section', name !== 'inicio');
      document.getElementById('perfil-section').classList.toggle('hidden-section', name !== 'perfil');
    }

    function createRooms() {
      const container = document.getElementById("rooms");
      for (let i = 1; i <= 10; i++) {
        const div = document.createElement("div");
        div.className = "room-card";
        div.innerHTML = `
        <div class="flex justify-between items-start mb-4">
          <h3 class="font-bold text-lg uppercase">Sala #${i}</h3>
          <div class="flex flex-col gap-1 text-[10px] text-right font-extrabold uppercase tracking-tighter">
            <button onclick="reclaimPrize(${i},1,5)" class="text-green-400">GIRO1Ô∏è‚É£ $5</button>
            <button onclick="reclaimPrize(${i},2,15)" class="text-green-300">GIRO2Ô∏è‚É£ $15</button>
            <button onclick="reclaimPrize(${i},3,50)" class="text-yellow-400">GIRO3Ô∏è‚É£ $50üèÜ</button>
          </div>
        </div>
        <div class="num-grid mb-4">${Array.from({length:200}, (_,n)=>`<div class="num-btn" onclick="this.classList.toggle('selected')">${n+1}</div>`).join('')}</div>
        <button onclick="buyTickets(${i})" class="w-full bg-green-600 py-3 rounded-full font-bold text-xs uppercase shadow-lg">Comprar Tickets</button>
        <iframe src="https://wheelofnames.com/bh2-bm6" width="100%" height="250"></iframe>`;
        container.appendChild(div);
      }
    }
    async function directRecharge() { if(currentUser) window.location.href = `ethereum:${MY_WALLET}`; }
    window.onload = createRooms;
  </script>
</body>
</html>
